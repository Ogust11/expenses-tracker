<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vercel Serverless Expense Tracker</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        h1 { text-align: center; color: #333; }
        form { background: #f9f9f9; padding: 20px; border-radius: 8px; margin-bottom: 30px; }
        label { display: block; margin-top: 10px; font-weight: bold; }
        input, select { width: 100%; padding: 8px; margin-top: 5px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; }
        button { background-color: #0070f3; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; margin-top: 20px; width: 100%; }
        button:hover { background-color: #005bb5; }
        #expenses-list { list-style: none; padding: 0; }
        #expenses-list li { background: #fff; padding: 15px; border-radius: 4px; border-left: 5px solid #0070f3; margin-bottom: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .expense-amount { font-weight: bold; color: #d33; }
    </style>
</head>
<body>
    <h1> Serverless Expense Tracker</h1>

    <form id="expense-form">
        <h2>Add New Expense</h2>
        <label for="description">Description</label>
        <input type="text" id="description" required>

        <label for="amount">Amount (€)</label>
        <input type="number" id="amount" step="0.01" required>

        <label for="category">Category</label>
        <select id="category" required>
            <option value="Food">Food</option>
            <option value="Transport">Transport</option>
            <option value="Bills">Bills</option>
            <option option="Other">Other</option>
        </select>

        <label for="date">Date</label>
        <input type="date" id="date" required>

        <button type="submit">Record Expense</button>
    </form>

    <hr>

    <h2>Recorded Expenses</h2>
    <ul id="expenses-list">
        <li>Loading expenses...</li>
    </ul>

    <script>
        const API_URL = '/api/expenses';
        const expenseForm = document.getElementById('expense-form');
        const expensesList = document.getElementById('expenses-list');

        // Function to fetch and display expenses
        async function fetchExpenses() {
            try {
                const response = await fetch(API_URL);
                const result = await response.json();

                expensesList.innerHTML = ''; // Clear existing list

                if (result.success && result.data.length > 0) {
                    result.data.forEach(expense => {
                        const li = document.createElement('li');
                        li.innerHTML = `
                            **${expense.description}** (${expense.category}) on ${expense.date}
                            <span class="expense-amount"> | **€${expense.amount.toFixed(2)}**</span>
                        `;
                        expensesList.appendChild(li);
                    });
                } else {
                    expensesList.innerHTML = '<li>No expenses recorded yet.</li>';
                }
            } catch (error) {
                console.error('Error fetching expenses:', error);
                expensesList.innerHTML = '<li>Error loading expenses. Check console.</li>';
            }
        }

        // Handle form submission (POST request)
        expenseForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const newExpense = {
                description: document.getElementById('description').value,
                amount: document.getElementById('amount').value,
                category: document.getElementById('category').value,
                date: document.getElementById('date').value,
            };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(newExpense),
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    alert('Expense added successfully!');
                    expenseForm.reset(); // Clear form fields
                    fetchExpenses(); // Refresh the list
                } else {
                    // Handle validation errors from the API
                    alert(`Failed to add expense: ${result.error || 'Unknown error'}`);
                }
            } catch (error) {
                console.error('Error posting expense:', error);
                alert('An unexpected error occurred. See console.');
            }
        });

        // Load expenses on page load
        document.addEventListener('DOMContentLoaded', fetchExpenses);
    </script>
</body>
</html>
